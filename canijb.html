<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rage’s jb checker</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white p-5">

    <h1 class="text-2xl text-center font-bold">Rage’s jb checker</h1>
    <div id="j"></div>
    <div class="text-center mt-5">
        Source: <a href="https://github.com/littlebyteorg/appledb" target="_blank" class="text-blue-400">littlebyteorg/appledb</a>
    </div>

    <script>
        const apiBase = "https://api.github.com/repos/littlebyteorg/appledb/contents/jailbreakFiles";
        const rawBase = "https://raw.githubusercontent.com/littlebyteorg/appledb/main/jailbreakFiles/";
        const devCache = new Map();

        async function getDevInfo(id) {
            if (devCache.has(id)) return devCache.get(id);
            const url = `https://api.ipsw.me/v4/device/${id}?type=ipsw`;
            let info = { name: id, vers: new Map() };

            try {
                let res = await fetch(url);
                if (!res.ok) throw new Error();
                let d = await res.json();
                info.name = d.name || id;
                d.firmwares?.forEach(f => info.vers.set(f.buildid, f.version));
                devCache.set(id, info);
            } catch (e) {}

            return info;
        }

        async function fetchJBs() {
            try {
                let res = await fetch(apiBase);
                let d = await res.json();
                d.filter(f => f.name.endsWith(".json")).forEach(f => fetchJBFile(f.name));
            } catch (e) {}
        }

        async function fetchJBFile(f) {
            try {
                let res = await fetch(rawBase + f);
                let d = await res.json();
                processJB(d, f);
            } catch (e) {}
        }

        async function processJB(d, f) {
            const c = document.createElement("div");
            c.className = "bg-gray-800 p-5 rounded-lg mt-5 max-w-lg mx-auto";

            const t = document.createElement("h2");
            t.className = "text-xl font-semibold text-center";
            t.textContent = d.info?.name?.trim() || f.replace(".json", "");

            const p1 = mk("Latest Version", d.info?.latestVer);
            const p2 = mk("Type", d.info?.type);
            const p3 = mk("Notes", d.info?.notes);

            const s = document.createElement("select");
            s.className = "w-full bg-gray-700 p-2 mt-2 rounded";
            s.innerHTML = `<option value="">Select a device</option>`;

            const i = document.createElement("div");
            i.className = "hidden bg-gray-700 p-3 rounded mt-3";
            const l = document.createElement("ul");

            let devMap = {};

            for (const e of d.compatibility) {
                for (const v of e.devices) {
                    if (!devMap[v]) devMap[v] = new Set();
                    e.firmwares.forEach(fw => devMap[v].add(fw));
                }
            }

            const uDevs = Object.keys(devMap);
            const devs = await Promise.all(uDevs.map(getDevInfo));

            uDevs.forEach((v, i) => {
                let o = document.createElement("option");
                o.value = v;
                o.textContent = devs[i].name;
                s.appendChild(o);
            });

            s.addEventListener("change", function () {
                let v = this.value;
                if (v) {
                    l.innerHTML = "";
                    devMap[v].forEach(fw => {
                        let li = document.createElement("li");
                        let devInfo = devCache.get(v);
                        let ios = devInfo?.vers?.get(fw) || `Unknown (Build ${fw})`;
                        li.textContent = `${ios} (${fw})`;
                        l.appendChild(li);
                    });
                    i.classList.remove("hidden");
                } else {
                    i.classList.add("hidden");
                }
            });

            i.appendChild(l);
            c.append(t, p1, p2, p3, s, i);
            document.getElementById("j").appendChild(c);
        }

        function mk(k, v) {
            const p = document.createElement("p");
            p.innerHTML = `<strong>${k}:</strong> ${v || "N/A"}`;
            return p;
        }

        fetchJBs();
    </script>

</body>
</html>
